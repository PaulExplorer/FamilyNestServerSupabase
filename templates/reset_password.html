<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title data-t="RESET_PASSWORD_PAGE.TITLE">
      Reset Password - FamilyNest
    </title>
    <meta
      name="description"
      content="Reset your password for your FamilyNest account."
    />

    <link rel="stylesheet" href="/static/styles/login.css" />
    <script defer src="/static/scripts/translation.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        initTranslations(getBestLanguage());
      });
    </script>
  </head>
  <body>
    <div class="login-container" style="display: block">
      <div class="form-panel" style="width: 100%; border-radius: 12px">
        <div id="reset-password-form" class="form-container active">
          <h2 class="form-title" data-t="RESET_PASSWORD_PAGE.FORM.TITLE">
            Reset your password
          </h2>
          <p class="form-subtitle" data-t="RESET_PASSWORD_PAGE.FORM.SUBTITLE">
            Please enter your new password below.
          </p>
          {% if error %}
          <div class="error">
            <i>‚ùå</i> <span data-t="{{error_t}}">{{ error }}</span>
          </div>
          {% endif %} {% if message %}
          <div class="message">
            <i>‚úÖ</i> <span data-t="{{message_t}}">{{ message }}</span>
          </div>
          {% endif %}
          <form
            action="{{ url_for('auth.reset_password') }}"
            method="POST"
            id="resetPasswordForm"
          >
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
            <input
              type="hidden"
              name="access_token"
              id="access_token"
              value="{{ access_token or '' }}"
            />
            <input
              type="hidden"
              name="refresh_token"
              id="refresh_token"
              value="{{ refresh_token or '' }}"
            />

            <div class="input-group">
              <input
                type="password"
                name="new_password"
                id="new_password"
                autocomplete="new-password"
                data-t-placeholder="RESET_PASSWORD_PAGE.FORM.NEW_PASSWORD_PLACEHOLDER"
                required
              />
              <span class="password-toggle" id="newPasswordToggle">üëÅÔ∏è</span>
            </div>
            <div class="input-group">
              <input
                type="password"
                name="confirm_password"
                id="confirm_password"
                autocomplete="new-password"
                data-t-placeholder="RESET_PASSWORD_PAGE.FORM.CONFIRM_PASSWORD_PLACEHOLDER"
                required
              />
              <span class="password-toggle" id="confirmPasswordToggle">üëÅÔ∏è</span>
            </div>
            <button
              type="submit"
              class="btn-submit"
              data-t="RESET_PASSWORD_PAGE.FORM.SUBMIT_BUTTON"
            >
              Reset Password
            </button>
          </form>
        </div>
      </div>
    </div>

    <script>
      function togglePassword(inputId, toggleId) {
        const passwordInput = document.getElementById(inputId);
        const toggleButton = document.getElementById(toggleId);

        toggleButton.addEventListener("click", function () {
          if (passwordInput.type === "password") {
            passwordInput.type = "text";
            toggleButton.textContent = "üëÅÔ∏è";
          } else {
            passwordInput.type = "password";
            toggleButton.textContent = "üëÅÔ∏è";
          }

          passwordInput.focus();
        });
      }
      togglePassword("new_password", "newPasswordToggle");
      togglePassword("confirm_password", "confirmPasswordToggle");

      window.addEventListener("load", function () {
        const hash = window.location.hash.substring(1);
        if (hash) {
          const params = new URLSearchParams(hash);
          const accessToken = params.get("access_token");
          if (accessToken) {
            document.getElementById("access_token").value = accessToken;
          } else {
            // Handle the case where the token is not present
            const form = document.getElementById("reset-password-form");
            form.innerHTML = `<div class="error"><i>‚ùå</i><span data-t="RESET_PASSWORD_PAGE.MESSAGES.INVALID_TOKEN">${translate(
              "RESET_PASSWORD_PAGE.MESSAGES.INVALID_TOKEN"
            )}</span></div>`;
          }
          const refreshToken = params.get("refresh_token");
          if (refreshToken) {
            document.getElementById("refresh_token").value = refreshToken;
          } else {
            // Handle the case where the token is not present
            const form = document.getElementById("reset-password-form");
            form.innerHTML = `<div class="error"><i>‚ùå</i><span data-t="RESET_PASSWORD_PAGE.MESSAGES.INVALID_TOKEN">${translate(
              "RESET_PASSWORD_PAGE.MESSAGES.INVALID_TOKEN"
            )}</span></div>`;
          }
        }
      });
    </script>
  </body>
</html>
