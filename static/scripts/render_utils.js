var selectPerson=(a=>{setRecenterOn(a);window.wasmBindings.select_person(a.dataset.id,a.dataset.mainspouse)});var cancelAddPerson=(a=>{let b=null;selectPerson(a);personAdd=[b,b,b,b]});var setRecenterOn=(a=>{let d=parseInt;const b=d(a.dataset.x);const c=d(a.dataset.y);prevLocation={x:b,y:c}});var addPersonInterface=(a=>{let b=null;setRecenterOn(a);personAdd=[b,b,b,a.dataset.mainspouse];window.wasmBindings.add_person_interface(a.dataset.id)});var displayPerson=(a=>{let b=2;prevLocation={x:viewBox.x+ viewBox.w/b,y:viewBox.y+ viewBox.h/b};window.wasmBindings.select_person(a,null)});var addPerson=(async(a,b)=>{let c=relationsTypeByID[a.dataset.id];let d=await window.wasmBindings.get_new_person(b,c);setRecenterOn(a);personAdd=[b,c,d,personAdd[3]];openAddPanel()});var panZoomTiger;var conteneur;var svg;let viewBox;var prevLocation;const MAX_ZOOM_OUT=16;const MAX_ZOOM_IN=0.5;window.initializePanzoom=a=>{let y=`click`,u=`viewBox`,w=1,x=2,v=0;conteneur=document.getElementById(a);if(!conteneur){console.error(`Container with ID '${a}' not found.`);return};svg=conteneur.querySelector(`svg`);if(!svg){console.error(`SVG element not found inside the container.`);return};const b=svg.getAttribute(u).split(` `).map(Number);viewBox={x:b[v],y:b[w],w:b[x],h:b[3]};const c=b[x]*MAX_ZOOM_OUT;const d=b[x]*MAX_ZOOM_IN;let e=!1;let f={x:v,y:v};let g=v;const h=()=>{svg.setAttribute(u,`${viewBox.x} ${viewBox.y} ${viewBox.w} ${viewBox.h}`)};const i=a=>{if(a.touches){return {x:a.touches[v].clientX,y:a.touches[v].clientY}};return {x:a.clientX,y:a.clientY}};const j=a=>{const b=a[v].clientX- a[w].clientX;const c=a[v].clientY- a[w].clientY;return Math.sqrt(b*b+ c*c)};const k=a=>({x:(a[v].clientX+ a[w].clientX)/x,y:(a[v].clientY+ a[w].clientY)/x});const l=(a,b)=>{const {width:e,height:f,left:g,top:i}=conteneur.getBoundingClientRect();const j={x:viewBox.x+ ((b.x- g)*viewBox.w)/e,y:viewBox.y+ ((b.y- i)*viewBox.h)/f};const k=viewBox.w*a;const l=viewBox.h*a;if(k<d||k>c){return};viewBox.w=k;viewBox.h=l;viewBox.x=j.x- ((b.x- g)*k)/e;viewBox.y=j.y- ((b.y- i)*l)/f;h()};const m=a=>{if(a.touches&&a.touches.length===x){e=!1;g=j(a.touches)}else{e=!0;f=i(a)}};const n=a=>{a.preventDefault();if(a.touches&&a.touches.length===x){const b=j(a.touches);const c=k(a.touches);const d=g/b;l(d,c);g=b}else if(e){const b=i(a);const c=f.x- b.x;const d=f.y- b.y;const {width:e}=conteneur.getBoundingClientRect();const g=viewBox.w/e;viewBox.x+=c*g;viewBox.y+=d*g;h();f=b}};const o=a=>{e=!1;g=v};const p=a=>{a.preventDefault();const b=0.1;const c=a.deltaY<v?w- b:w+ b;const d={x:a.clientX,y:a.clientY};l(c,d)};conteneur.addEventListener(`mousedown`,m);conteneur.addEventListener(`mousemove`,n);conteneur.addEventListener(`mouseup`,o);conteneur.addEventListener(`mouseleave`,o);conteneur.addEventListener(`wheel`,p);conteneur.addEventListener(`touchstart`,m,{passive:!1});conteneur.addEventListener(`touchmove`,n,{passive:!1});conteneur.addEventListener(`touchend`,o);conteneur.addEventListener(`touchcancel`,o);h();const q=document.getElementById(`zoom-in-button`);const r=document.getElementById(`zoom-out-button`);const s=a=>{const {width:b,height:c,left:d,top:e}=conteneur.getBoundingClientRect();const f={x:d+ b/x,y:e+ c/x};l(a,f)};if(q){q.addEventListener(y,()=>s(0.8))};if(r){r.addEventListener(y,()=>s(1.25))};prevLocation={x:viewBox.x+ viewBox.w/x,y:viewBox.y+ viewBox.h/x};const t=()=>{const {width:a,height:b}=conteneur.getBoundingClientRect();if(a===v||b===v)return;const c=a/b;const d=viewBox.w/viewBox.h;const e=viewBox.x+ viewBox.w/x;const f=viewBox.y+ viewBox.h/x;if(c>d){viewBox.w=viewBox.h*c}else{viewBox.h=viewBox.w/c};viewBox.x=e- viewBox.w/x;viewBox.y=f- viewBox.h/x;h()};window.addEventListener(`resize`,t)};window.attachSvgEventListeners=()=>{let b=`click`;const a=svg.querySelectorAll(`.person`);a.forEach(a=>{let c=a.querySelector(`.reduce-icon`);let d=a.querySelector(`.add_icon`);let e=a.querySelector(`.cancel_icon`);if(c){c.addEventListener(b,()=>selectPerson(a))};if(d){d.addEventListener(b,()=>addPersonInterface(a))};if(e){e.addEventListener(b,()=>cancelAddPerson(a))}})};const relationsTypeByID={"-100":`mother`,"-101":`father`,"-102":`son`,"-103":`daughter`,"-104":`spouse`};window.recenterOn=a=>{let g=parseInt;const b=svg.querySelector(`#person-${a}`);const c=g(b.dataset.x);const d=g(b.dataset.y);const e=c- prevLocation.x;const f=d- prevLocation.y;viewBox.x+=e;viewBox.y+=f;svg.setAttribute(`viewBox`,`${viewBox.x} ${viewBox.y} ${viewBox.w} ${viewBox.h}`)};const searchBar=document.getElementById(`search-bar`);const searchResults=document.getElementById(`results`);searchBar.addEventListener(`input`,(()=>{let b=``,d=`span`,e=1,c=2;let a=window.wasmBindings.search_persons(searchBar.value);searchResults.innerHTML=b;a.forEach(a=>{const f=document.createElement(`div`);f.classList.add(`result-item`);f.dataset.id=a[c];const g=document.createElement(d);g.classList.add(`result-name`);g.textContent=a[0];f.appendChild(g);if(a[e]){const b=document.createElement(d);b.classList.add(`result-dates`);b.textContent=`(${a[e]})`;f.appendChild(b)};f.addEventListener(`click`,()=>{displayPerson(a[c]);searchResults.innerHTML=b;searchBar.value=b});searchResults.appendChild(f)})}))