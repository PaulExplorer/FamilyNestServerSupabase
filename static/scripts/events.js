var fetchNominatim=(async(a)=>{try{const b=await fetch(`${NOMINATIM_API_URL}${encodeURIComponent(a)}`);if(!b.ok)throw new Error(`HTTP error! status: ${b.status}`);return await b.json()}catch(a){console.error(`Error fetching Nominatim data:`,a);return []}});var createEventElement=((a,b=null,c=v)=>{let G=`0`,F=2,J=`note`,D=`input`,x=`-`,B=` `,C=1,H=`place`,y=``,z=`.events-selector`,I=`hidden`,A=`date-precision`,v=0,E=`number`,w=`div`;const d=document.createElement(w);d.classList.add(`event`);d.id=`${a}-${c}`;const e=document.createElement(w);e.classList.add(`event-header`);const f=document.createElement(`p`);f.textContent=translate(eventTypesTranslateKey[a]);e.appendChild(f);const g=document.createElement(`button`);g.classList.add(`remove-event-button`);g.innerHTML=`<img src="/static/images/icons/delete_24dp_FFF_FILL0_wght400_GRAD0_opsz24.svg" alt="${translate(`ALT.DELETE`)}"/>`;g.addEventListener(`click`,()=>{const a=d.closest(`.modal`)||d.closest(`aside`);const b=a.querySelector(`.event-choice`);const [c]=d.id.split(x);d.remove();if(!repeatableEvents.has(c)){b.appendChild(new Option(translate(eventTypesTranslateKey[c]),c));const a=Array.from(b.options);a.sort((a,b)=>eventOrder[a.value]- eventOrder[b.value]);b.innerHTML=y;a.forEach(a=>b.appendChild(a))};if(a.querySelector(z).style.display===`none`){a.querySelector(z).style.display=`flex`}});if(is_local_editable){e.appendChild(g)};d.appendChild(e);const h=document.createElement(w);h.classList.add(`date`);const i=document.createElement(`select`);i.name=A;i.classList.add(A);i.id=`date-precision-${d.id}`;for(const a in datePrecisionsTranslateKey){const b=document.createElement(`option`);b.value=a;b.textContent=translate(datePrecisionsTranslateKey[a]);i.appendChild(b)};i.value=b?b.date.split(B)[v]:`Nor.`;h.appendChild(i);let j=b?b.date.split(B)[C].split(x):[y,y,y];const k=document.createElement(D);k.classList.add(`day`);k.name=`date-day`;k.type=E;k.placeholder=translate(`DATE.DAY`);k.value=j[F]||y;k.min=G;k.max=`31`;h.appendChild(k);const l=document.createElement(D);l.classList.add(`month`);l.name=`date-month`;l.type=E;l.placeholder=translate(`DATE.MONTH`);l.value=j[C]||y;l.min=G;l.max=`12`;h.appendChild(l);const m=document.createElement(D);m.classList.add(`year`);m.name=`date-year`;m.type=E;m.placeholder=translate(`DATE.YEAR`);m.value=j[v]||y;m.min=G;m.max=`9999`;h.appendChild(m);d.appendChild(h);const n=document.createElement(w);n.classList.add(`place-search-container`);const o=document.createElement(D);o.classList.add(H);o.name=H;o.type=`text`;o.placeholder=translate(`PLACEHOLDER.PLACE`);o.value=b?b.place.display_name:y;n.appendChild(o);const p=document.createElement(w);p.classList.add(`place-search-results`);n.appendChild(p);d.appendChild(n);const q=document.createElement(D);q.type=I;q.classList.add(`place-name`);q.value=b&&b.place.name?b.place.name:y;d.appendChild(q);const r=document.createElement(D);r.type=I;r.classList.add(`place-latitude`);r.value=b&&b.place.coord?b.place.coord.latitude:y;d.appendChild(r);const s=document.createElement(D);s.type=I;s.classList.add(`place-longitude`);s.value=b&&b.place.coord?b.place.coord.longitude:y;d.appendChild(s);let t;o.addEventListener(D,()=>{clearTimeout(t);t=setTimeout(async()=>{const a=o.value.trim();if(a.length>F){r.value=y;s.value=y;p.innerHTML=y;const b=await fetchNominatim(a);displayPlaceSearchResults(p,o,q,r,s,b)}else{p.innerHTML=y}},500)});const u=document.createElement(`textarea`);u.classList.add(J);u.name=J;u.placeholder=translate(`PLACEHOLDER.NOTE`);u.value=b?b.note:y;d.appendChild(u);if(!is_local_editable){i.disabled=!0;k.disabled=!0;l.disabled=!0;m.disabled=!0;o.disabled=!0;u.disabled=!0};return d});var parseDate=(a=>{let h=1,g=0;if(!a||typeof a!==`string`){return {year:g,month:g,day:g}};const b=a.split(` `);const c=b.length>h?b[h]:b[g];const [d,e,f]=c.split(`-`).map(a=>parseInt(a,10)||g);return {year:d,month:e,day:f}});var displayPlaceSearchResults=((a,b,c,d,e,f)=>{let g=``;a.innerHTML=g;if(f.length===0){a.innerHTML=`<div class='no-results'>${translate(`FORM.NO_RESULT_FOUND`)}</div>`;return};f.forEach(f=>{const h=document.createElement(`div`);h.classList.add(`place-search-result-item`);h.textContent=f.display_name;h.addEventListener(`click`,()=>{b.value=f.display_name;c.value=f.name;d.value=f.lat;e.value=f.lon;a.innerHTML=g});a.appendChild(h)})});var addEventToSource=((a,b)=>{let i=``,j=Array.from;const c=a.querySelector(`.events`);const d=a.querySelector(`.event-choice`);c.innerHTML=i;d.innerHTML=i;const e=new Map();for(const [a,c] of b.entries()){if(eventTypesTranslateKey[a]){const b=eventOrder[a];if(!e.has(b)){e.set(b,[])};const d=e.get(b);c.forEach((b,c)=>{d.push({eventType:a,event:b,originalIndex:c})})}};const f=j(e.entries()).sort(([a],[b])=>a- b);for(const [,a] of f){a.sort((a,b)=>{const c=parseDate(a.event.date);const d=parseDate(b.event.date);if(c.year!==d.year)return c.year- d.year;if(c.month!==d.month)return c.month- d.month;return c.day- d.day});a.forEach(({eventType:a,event:b,originalIndex:d})=>{c.appendChild(createEventElement(a,b,d))})};const g=j(b.keys());const h=Object.keys(eventTypesTranslateKey).filter(a=>!g.includes(a)||repeatableEvents.has(a));a.querySelector(`.events-selector`).style.display=h.length===0?`none`:`flex`;h.forEach(a=>d.appendChild(new Option(translate(eventTypesTranslateKey[a]),a)))});var createSourceElement=((a=``)=>{const b=document.createElement(`div`);b.classList.add(`source-item`);const c=document.createElement(`input`);c.type=`text`;c.classList.add(`source-input`);c.value=a;c.placeholder=translate(`PLACEHOLDER.SOURCE`);b.appendChild(c);if(is_local_editable){const a=document.createElement(`button`);a.classList.add(`remove-source-button`);a.innerHTML=`<img src="/static/images/icons/delete_24dp_FFF_FILL0_wght400_GRAD0_opsz24.svg" alt="${translate(`ALT.DELETE`)}"/>`;a.addEventListener(`click`,()=>{b.remove();currentPerson.sources.splice(currentPerson.sources.indexOf(c.value),1)});b.appendChild(a)}else{c.disabled=!0};return b});var addSourcesToSource=((a,b)=>{const c=a.querySelector(`.sources-list`);c.innerHTML=``;if(b&&b.length>0){b.forEach(a=>c.appendChild(createSourceElement(a)))}});var addEventBoutonFunction=(a=>{let j=0,k=Array.from;const b=a.querySelector(`.event-choice`);const c=b.selectedOptions[j];if(!c)return;const d=c.value;const e=a.querySelector(`.events`);const f=k(e.children).filter(a=>a.id.startsWith(`${d}-`));const g=createEventElement(d,null,f.length);const h=eventOrder[d];const i=k(e.children).find(a=>eventOrder[a.id.split(`-`)[j]]>h);e.insertBefore(g,i);if(!repeatableEvents.has(d)){c.remove()};a.querySelector(`.events-selector`).style.display=b.children.length===j?`none`:`flex`});detailsModal.querySelector(`.add-source-button`).addEventListener(`click`,()=>{detailsModal.querySelector(`.sources-list`).appendChild(createSourceElement())});sidePanel.querySelector(`.event-add`).addEventListener(`click`,()=>addEventBoutonFunction(sidePanel));detailsModal.querySelector(`.event-add`).addEventListener(`click`,()=>addEventBoutonFunction(detailsModal))