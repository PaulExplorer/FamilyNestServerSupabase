var createChart=((a,b,c,d)=>{const e=document.getElementById(a).getContext(`2d`);if(charts[a]){charts[a].destroy()};charts[a]=new Chart(e,{type:b,data:c,options:d})});var loadStats=(()=>{let p=2,h=`#e3e3e3`,r=`STATS.AGE`,n=`rgba(255, 99, 132, 0.6)`,j=`bar`,i=`rgba(227, 227, 227, 0.2)`,l=1,o=`rgba(75, 192, 192, 0.6)`,m=`rgba(54, 162, 235, 0.6)`,k=0,q=`pie`;const a=window.wasmBindings.get_stats();document.getElementById(`total-persons`).textContent=a.total_persons;const b={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{labels:{color:h}}},scales:{y:{beginAtZero:!0,ticks:{color:h},grid:{color:i}},x:{ticks:{color:h},grid:{color:i}}}};createChart(`top-10-lastname-chart`,j,{labels:a.top_10_lastname.map(a=>a[k]),datasets:[{label:translate(`STATS.LASTNAMES`),data:a.top_10_lastname.map(a=>a[l]),backgroundColor:m}]},b);createChart(`top-10-firstname-chart`,j,{labels:a.top_10_firstname.map(a=>a[k]),datasets:[{label:translate(`STATS.FIRSTNAMES`),data:a.top_10_firstname.map(a=>a[l]),backgroundColor:n}]},b);createChart(`event-types-chart`,j,{labels:a.event_types.map(a=>translate(eventTypesTranslateKey[a[k]])),datasets:[{label:translate(`STATS.EVENTS`),data:a.event_types.map(a=>a[l]),backgroundColor:o}]},b);const c=a.ages_when_died;const d=[...new Set(c.map(a=>a[l]))].sort();const e=d.map(a=>c.find(b=>b[k]===`M`&&b[l]===a)?.[p]||k);const f=d.map(a=>c.find(b=>b[k]===`F`&&b[l]===a)?.[p]||k);createChart(`ages-when-died-chart`,j,{labels:d,datasets:[{label:translate(`PERSON.SEX.MALE`),data:e,backgroundColor:m},{label:translate(`PERSON.SEX.FEMALE`),data:f,backgroundColor:n}]},{...b,scales:{...b.scales,x:{...b.scales.x,stacked:!0},y:{...b.scales.y,stacked:!0}}});const g={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{labels:{color:h}}}};createChart(`child-per-family-chart`,q,{labels:a.child_per_family.map(a=>translate(`STATS.CHILDREN`,{count:a[k]})),datasets:[{data:a.child_per_family.map(a=>a[l])}]},g);createChart(`as-photo-chart`,q,{labels:[translate(`STATS.WITH_PHOTO`),translate(`STATS.WITHOUT_PHOTO`)],datasets:[{data:a.as_photo.sort((a,b)=>a[k]===b[k]?k:a[k]?-l:l).map(a=>a[l]),backgroundColor:[o,n]}]},g);createChart(`origin-country-chart`,`polarArea`,{labels:a.origin_country.map(a=>a[k]),datasets:[{data:a.origin_country.map(a=>a[l])}]},g);createChart(`gender-distribution-chart`,q,{labels:a.gender_distribution.map(a=>a[k]),datasets:[{data:a.gender_distribution.map(a=>a[l]),backgroundColor:[m,n,`rgba(201, 203, 207, 0.6)`]}]},g);createChart(`with-sources-chart`,q,{labels:[translate(`STATS.WITH_SOURCES`),translate(`STATS.WITHOUT_SOURCES`)],datasets:[{data:a.with_sources.sort((a,b)=>a[k]===b[k]?k:a[k]?-l:l).map(a=>a[l]),backgroundColor:[o,n]}]},g);createChart(`life-expectancy-chart`,j,{labels:a.life_expectancy_by_century.map(a=>translate(`STATS.CENTURY`,{century:a[k]})),datasets:[{label:translate(r),data:a.life_expectancy_by_century.map(a=>a[l]),backgroundColor:`rgba(153, 102, 255, 0.6)`}]},{...b,plugins:{...b.plugins,legend:{display:!1}},scales:{...b.scales,y:{...b.scales.y,title:{display:!0,text:translate(r),color:h}}}});createChart(`birth-months-chart`,j,{labels:a.birth_months.map(a=>translate(a[k])),datasets:[{label:translate(`STATS.BIRTH_MONTHS`),data:a.birth_months.map(a=>a[l]),backgroundColor:`rgba(255, 206, 86, 0.6)`}]},b)});var destroyCharts=(()=>{Object.values(charts).forEach(a=>{if(a){a.destroy()}});charts={}});const statsModal=document.getElementById(`stats-modal-overlay`);const openStatsModalButton=document.getElementById(`stats-btn`);const closeStatsModalButton=document.getElementById(`close-stats-modal-btn`);let charts={};openStatsModalButton.addEventListener(`click`,()=>{statsModal.classList.add(`open`);loadStats()});closeStatsModalButton.addEventListener(`click`,()=>{statsModal.classList.remove(`open`);destroyCharts()});statsModal.addEventListener(`click`,a=>{if(a.target===statsModal){statsModal.classList.remove(`open`);destroyCharts()}});document.addEventListener(`keydown`,a=>{let b=`open`;if(a.key===`Escape`&&statsModal.classList.contains(b)){statsModal.classList.remove(b);destroyCharts()}})