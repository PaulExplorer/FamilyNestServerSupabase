var reconstructPersonFromSource=(a=>{let e=`0`,l=`female`,k=`male`,j=1,f=``,h=`.notes`,i=0,g=parseFloat;if(!currentPerson)return;const b={};a.querySelectorAll(`.events .event`).forEach(a=>{const [c,d]=a.id.split(`-`);const h=parseInt(d,10);const i=a.querySelector(`.date-precision`).value;const j=a.querySelector(`.day`).value||e;const k=a.querySelector(`.month`).value||e;const l=a.querySelector(`.year`).value||e;let m=a.querySelector(`.place`).value;let n=a.querySelector(`.place-name`).value;let o=a.querySelector(`.place-latitude`).value;let p=a.querySelector(`.place-longitude`).value;if(m.trim()===f){n=f;o=f;p=f};if(!b[c])b[c]=[];b[c][h]={date:`${i} ${l}-${k}-${j}`,place:{name:n,display_name:m,coord:o&&p?{latitude:g(o),longitude:g(p)}:null},note:a.querySelector(`.note`).value}});const c=[];if(a.querySelector(`.sources-list`)){a.querySelectorAll(`.sources-list .source-input`).forEach(a=>c.push(a.value))};const d={id:currentPerson.id,firstname:a.querySelector(`.first-name`).value.trim(),lastname:a.querySelector(`.last-name`).value.toUpperCase().trim(),nickname:a.querySelector(`.nickname`).value.trim(),gender:a.querySelector(`.sex`).value,country:a.querySelector(`.country`).value.trim(),job:a.querySelector(`.jobs`).value.trim(),notes:a.querySelector(h)?a.querySelector(h).value:currentPerson.notes,sources:c.length>i?c:currentPerson.sources,events:b,parents:currentPerson.parents,spouses:currentPerson.spouses,photo:currentPerson.photo,documents:currentPerson.documents,version:currentPerson.version};if(a.classList.contains(`person-add`)){let a=f;if(personAdd[j]==`son`||personAdd[j]==`daughter`)a=`child`;else if(personAdd[j]==`father`||personAdd[j]==`mother`)a=`parent`;else a=`spouse`;window.wasmBindings.add_person(personAdd[i],a,d,personAdd[3]);closeDetailsModal()}else{const a=document.getElementById(`person-`+ d.id);if(a){a.querySelector(`.fullname`).textContent=fullName(d).substring(i,24);a.querySelector(`.life-span`).textContent=lifeSpanStr(d);a.classList.remove(k,l);if(d.gender==`M`)a.classList.add(k);else if(d.gender==`F`)a.classList.add(l);a.querySelector(`image`).href.baseVal=d.photo||`/static/images/default.png`};window.wasmBindings.update_person(d)};a.classList.remove(`open`)});sidePanel.querySelector(`.save-button`).addEventListener(`click`,()=>reconstructPersonFromSource(sidePanel));detailsModal.querySelector(`.save-button`).addEventListener(`click`,()=>reconstructPersonFromSource(detailsModal));detailsModal.querySelector(`.add-button`).addEventListener(`click`,()=>reconstructPersonFromSource(detailsModal))